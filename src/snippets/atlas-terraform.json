{
  "MongoDB Atlas Terraform Template": {
    "prefix": "atlas",
    "description": "Bootstraps Atlas configuration for Terraform",
    "body": [
      "#",
      "# Creates an Atlas Cluster using the MongoDB Atlas Terraform Provider",
      "# https://github.com/terraform-providers/terraform-provider-mongodbatlas",
      "# Docs: https://www.terraform.io/docs/providers/mongodbatlas/index.html",
      "#",
      "#  Variables we need for this terraform run",
      "#  Normally want to put them in their own variables.tf file or use Env variables",
      "#",
      "",
      "variable \"mongodb_atlas_api_pub_key\" { default = \"\"}",
      "variable \"mongodb_atlas_api_pri_key\" { default = \"\" }",
      "",
      "variable \"mongodb_atlas_org_id\" { default = \"\"}",
      "",
      "variable \"database_username\" { default = \"\" }",
      "variable \"database_user_password\" { default = \"\" }",
      "",
      "variable \"mongodb_atlas_whitelistip\" { default = \"\" }",
      "",
      "#",
      "# Configure the MongoDB Atlas Provider",
      "#",
      "provider \"mongodbatlas\" {",
      "  public_key   = \"${var.mongodb_atlas_api_pub_key}\"",
      "  private_key  = \"${var.mongodb_atlas_api_pri_key}\"",
      "}",
      "",
      "#",
      "# Create a Project ",
      "#",
      "resource \"mongodbatlas_project\" \"my_project\" {",
      "  name   = \"${1:atlasProjectName}\"",
      "  org_id = \"${var.mongodb_atlas_org_id}\"",
      "}",
      "",
      "#",
      "# Create a Cluster in 2 Regions",
      "#",
      "resource \"mongodbatlas_cluster\" \"cluster\" {",
      "  name                         = \"${2:atlasClusterName}\"",
      "  project_id                   = \"${mongodbatlas_project.my_project.id}\"",
      "  backup_enabled               = ${3|true,false|}",
      "  auto_scaling_disk_gb_enabled = ${4|true,false|}",
      "  mongo_db_major_version       = \"${5|3.6,4.0,4.2|}\"",
      "  cluster_type                 = \"${6|REPLICASET,SHARDED,GEOSHARDED|}\"",
      "",
      "  provider_name                = \"${7|AWS,GCP,AZURE,TENANT|}\"",
      "  disk_size_gb                 = ${8:diskSizeinGB}",
      "  provider_disk_iops           = ${9:diskSizeinGB}",
      "",
      "  # Instance size may depend on the provider. See docs here: https://docs.atlas.mongodb.com/reference/free-shared-limitations/",
      "  provider_instance_size_name  = \"${10|M2,M5,M10,M20,M30,M40,M50|}\"",
      "  provider_backup_enabled      = ${11|true,false|}",
      "",
      "  replication_specs {",
      "    num_shards                 = ${12:howManyShards}",
      "    regions_config {",
      "      # Region name depends on the provider:",
      "      # - AWS: https://docs.atlas.mongodb.com/reference/amazon-aws/#synopsis",
      "      # - GCP: https://docs.atlas.mongodb.com/reference/google-gcp/#synopsis",
      "      # - AZURE: https://docs.atlas.mongodb.com/reference/microsoft-azure/#synopsis",
      "      region_name              = \"${13:regionName}\"",
      "      priority                 = ${14:priority}",
      "      read_only_nodes          = ${15:howManyReadOnlyNodes}",
      "      analytics_nodes          = ${16:howManyAnalyticsNodes}",
      "      electable_nodes          = ${17:howElectableNodes}",
      "    }",
      "    regions_config {",
      "      # Region name depends on the provider:",
      "      # - AWS: https://docs.atlas.mongodb.com/reference/amazon-aws/#synopsis",
      "      # - GCP: https://docs.atlas.mongodb.com/reference/google-gcp/#synopsis",
      "      # - AZURE: https://docs.atlas.mongodb.com/reference/microsoft-azure/#synopsis",
      "      region_name              = \"${18:regionName}\"",
      "      priority                 = ${19:priority}",
      "      read_only_nodes          = ${20:howManyReadOnlyNodes}",
      "      analytics_nodes          = ${21:howManyAnalyticsNodes}",
      "      electable_nodes          = ${22:howElectableNodes}",
      "    }",
      "  }",
      "}",
      "",
      "#",
      "# Create a Database User",
      "#",
      "resource \"mongodbatlas_database_user\" \"test\" {",
      "  username         = \"${var.database_username}\"",
      "  password         = \"${var.database_user_password}\"",
      "  project_id       = \"${mongodbatlas_project.my_project.id}\"",
      "  database_name    = \"admin\"",
      "",
      "  roles {",
      "    role_name      = \"readWriteAnyDatabase\"",
      "    database_name  = \"admin\"",
      "  }",
      "}",
      "",
      "#",
      "# Create an IP Whitelist",
      "#",
      "resource \"mongodbatlas_project_ip_whitelist\" \"test\" {",
      "  project_id            = \"${mongodbatlas_project.my_project.id}\"  ",
      "  whitelist {  ",
      "    ip_address          = \"${var.mongodb_atlas_whitelistip}\"",
      "    comment             = \"Added with Terraform\"",
      "  }",
      "}"
    ]
  }
}
